# 要件定義書 v2.0

## プロジェクト概要
**AIコンシェルジュ搭載の次世代ポートフォリオサイト**

訪問者が「あっちゃんAI」と対話することで、開発相談からサイト生成まで体験できる、
インタラクティブな開発者ポートフォリオ。

### プロジェクト名
**あっちゃんAI - 石川敦大のAIコンシェルジュサイト**

### コンセプト
> 「見るだけ」のポートフォリオから、「使える・体験できる」ポートフォリオへ

---

## 目的

### 主要目的
1. **受託開発案件の獲得**
   - 個人での開発案件受注を獲得するための営業ツール
   - AIとの対話を通じた自然なリード獲得
   - 技術力を「体験」で証明する

2. **訪問者への価値提供**
   - 開発相談をその場で解決
   - サイトデザインのプロトタイプを即座に生成
   - 実用的なツールとして機能

3. **圧倒的な差別化**
   - 「また別のポートフォリオか」と思わせない
   - SNSでシェアされるユニークな体験
   - 技術力の証明（AIを活用できる開発者）

### サブ目的
- 訪問者のニーズデータ収集
- 個人ブランディングの強化
- 継続的な学習と実験の場

---

## 機能要件

### 🤖 1. あっちゃんAI（メイン機能）

#### 1-1. AIチャット機能
- [ ] リアルタイムチャット（ストリーミング表示）
- [ ] 会話履歴の保存（訪問者ごと）
- [ ] 自然言語での開発相談対応
- [ ] 要件ヒアリング（対話形式）
- [ ] 技術スタック提案
- [ ] 工数・概算見積もり提示
- [ ] お問い合わせへの自然な誘導

#### 1-2. 訪問者識別・パーソナライズ
- [ ] Cookie + Fingerprint による識別
- [ ] 会話内で名前を取得（任意）
- [ ] 再訪問時の会話復元
- [ ] 「○○さん、おかえりなさい」機能
- [ ] 過去の相談内容を踏まえた継続的な会話
- [ ] RAG（Retrieval-Augmented Generation）による長期記憶

#### 1-3. サイト生成機能 ⭐
- [ ] 要件に基づく**HTML/CSS/JavaScript**コード生成
- [ ] Tailwind CSS ベースのモダンデザイン
- [ ] インタラクティブな要素（JS使用）
- [ ] リアルタイムプレビュー表示（iframe）
- [ ] レスポンシブデザイン対応
- [ ] デザイン調整リクエスト対応
- [ ] 複数パターン生成（「別案を見せて」）

#### 1-4. 使用制限・悪用対策
- [ ] Tier制の使用制限
  - **Tier 1（匿名）**: 1日5メッセージ
  - **Tier 2（名前登録）**: 1日10メッセージ + サイト生成
  - **Tier 3（メール登録）**: 1日30メッセージ + 履歴保存
  - **Tier 4（問い合わせ済み）**: 無制限
- [ ] Rate Limiting（Upstash Redis）
- [ ] IP制限・異常検知
- [ ] Bot検知（行動分析）
- [ ] 残りメッセージ数の表示
- [ ] 制限到達時のアップグレード誘導

---

### 🎨 2. UI/UX（超こだわり）⭐

#### 2-1. トップページ（チャット画面）
- [ ] **ミニマルで洗練されたデザイン**
- [ ] **GSAP による滑らかなアニメーション**
  - ページロード時のトランジション
  - メッセージ送信・受信のアニメーション
  - スムーズなスクロール
- [ ] **パーティクルエフェクト**（背景）
- [ ] **タイピングエフェクト**（AI応答時）
- [ ] **マイクロインタラクション**
  - ボタンホバー時の変化
  - 入力フィールドのフォーカス効果
  - メッセージ追加時のアニメーション
- [ ] **レスポンシブ対応**（モバイルファースト）
- [ ] **ダークモード対応**

#### 2-2. チャットUI
- [ ] 吹き出し形式のメッセージ表示
- [ ] ユーザー/AI の明確な区別
- [ ] コードブロックのシンタックスハイライト
- [ ] リンクの自動検出
- [ ] 画像の埋め込み表示
- [ ] ローディングインジケーター（AI思考中）
- [ ] 自動スクロール（最新メッセージへ）
- [ ] 入力中インジケーター（「あっちゃんが入力中...」）

#### 2-3. コード生成プレビュー画面
- [ ] **左右分割レイアウト**（デスクトップ）
  - 左: 生成コード（シンタックスハイライト）
  - 右: リアルタイムプレビュー（iframe）
- [ ] **タブ切り替え**（モバイル）
  - コード表示 / プレビュー表示
- [ ] フルスクリーンモード
- [ ] レスポンシブプレビュー切り替え
  - デスクトップ / タブレット / モバイル表示

#### 2-4. アニメーション・エフェクト（GSAP活用）
- [ ] ページ遷移（Fade / Slide）
- [ ] メッセージ出現アニメーション（Stagger）
- [ ] プレビュー画面の展開アニメーション
- [ ] ボタンのリップルエフェクト
- [ ] パララックス効果（オプション）
- [ ] モーフィングトランジション

---

### 🔐 3. 管理画面（「あっちゃんの中身」）⭐

#### 3-1. 認証
- [ ] Supabase Auth によるログイン
- [ ] メール/パスワード認証
- [ ] セッション管理
- [ ] **石川さん専用**（1アカウントのみ）
- [ ] ログインURL: `/admin/secret-entrance` または `/atsuhiro`

#### 3-2. ダッシュボード
- [ ] **統計情報カード**
  - 今日の訪問者数
  - 今日のチャット数
  - 今月のサイト生成数
  - コンバージョン率（問い合わせ率）
  - OpenAI API 使用量・コスト
- [ ] **リアルタイム活動**
  - 現在の訪問者数
  - 最新の会話（リアルタイム更新）
- [ ] **人気の相談内容**
  - ワードクラウド
  - カテゴリ別グラフ

#### 3-3. 会話履歴管理
- [ ] **全ての訪問者との会話履歴を閲覧**
- [ ] フィルタリング
  - 日付範囲
  - 訪問者名
  - Tier
  - 「問い合わせ見込み」フラグ
- [ ] 検索機能（会話内容で全文検索）
- [ ] 会話詳細表示（タイムライン形式）
- [ ] **メモ追加機能**（内部メモ）
- [ ] **フラグ管理**
  - 🟢 見込みあり
  - 🔴 要フォローアップ
  - ⚪ 通常
- [ ] エクスポート機能（CSV/JSON）

#### 3-4. 訪問者管理
- [ ] 訪問者一覧（テーブル表示）
- [ ] 詳細情報
  - 名前（登録されている場合）
  - Tier
  - 訪問回数
  - 最終訪問日時
  - 総メッセージ数
  - 生成したサイト数
- [ ] **手動Tierアップ**（特定ユーザーを無制限に）
- [ ] **ブロック機能**（悪用者対策）
- [ ] 訪問者ごとの会話履歴へのリンク

#### 3-5. サイト生成ログ
- [ ] **生成されたサイトの一覧**
- [ ] サムネイルプレビュー
- [ ] 詳細情報
  - 生成日時
  - 訪問者
  - 要件（プロンプト）
  - 生成コード
- [ ] プレビュー表示（モーダル）
- [ ] コードダウンロード
- [ ] **「いいね」機能**（面白いデザインをマーク）
- [ ] ギャラリー表示（いいねしたサイトのみ）

#### 3-6. AI設定
- [ ] **システムプロンプト編集**
  - リアルタイムプレビュー
  - バージョン管理（履歴保存）
  - ロールバック機能
- [ ] **使用制限の調整**
  - Tier別メッセージ数
  - サイト生成回数
- [ ] **OpenAI設定**
  - モデル選択（gpt-4o / gpt-4o-mini）
  - Temperature調整
  - Max Tokens設定
- [ ] **RAG設定**（将来的）
  - 学習データの追加
  - ベクトルDB管理

#### 3-7. プロフィール編集 ⭐ NEW
- [ ] **動的なプロフィール情報管理**
  - 基本情報（名前、職業、所在地）
  - スキル（技術スタック、経験年数）
  - 趣味・個性（筋トレ、読書など）
  - **最近の出来事**（ベンチプレス100kg達成、学習中の技術など）
  - 実績（過去のプロジェクト、受賞歴）
  - 性格・価値観（仕事のスタイル、モットー）
- [ ] **カテゴリ別の整理**
- [ ] **優先度設定（更新順ベース）** ⭐
  - 新しい情報ほど高確率で会話に登場（50% → 30% → 15% → 4% → 1%）
  - 元の優先度（0-100）も加味
  - ランダム選択で自然なバリエーション
- [ ] **チャット表示のON/OFF切り替え**
- [ ] **内部メモ機能**（どう使うか、いつ更新したか）
- [ ] **リアルタイムプレビュー**（AIに送信されるプロンプトを確認）
- [ ] **項目の追加・編集・削除**

**使用例:**
```
ベンチプレス100kg達成
→ 管理画面で「recent_updates」に追加
→ 最新なので50%の確率で会話に登場
→ AIが「わぁ！あっちゃんも筋トレが好きで、最近ベンチプレス100kg上げられるようになったんだ💪」
```

#### 3-8. キャラクター設定 ⭐ NEW
- [ ] **10パターンの口調を用意**
  - 全て「穏やかで優しい、女性が好む」テーマ
  - パターン例: 「ふんわり優しい」「ポポポ系」「ほんわか癒し系」「お姉さん系」等
- [ ] **会話ごとにランダム選択**
  - 1つの会話内では1パターン固定
  - 再訪問時は別のキャラクターになる可能性
- [ ] **重み付き選択**
  - 人気のパターンはweightを高く設定
- [ ] **シーン別の定型文**
  - 挨拶、相槌、驚き、質問、提案、了承、考え中、励まし、感謝、締め
- [ ] **語尾・感嘆詞・絵文字スタイル**
  - 「〜なんだ」「ふふ」「✨🌸💫」など
- [ ] **見積もりでもキャラクター維持**
  - 「開発期間は2ヶ月くらいなんだ！費用は50万円くらいですね✨」

**キャラクター例:**
```
【パターン1: ふんわり優しい】
挨拶: 「こんにちは〜✨ お話しできて嬉しいです」
語尾: 「〜なんです、〜ですね」
絵文字: 「✨🌸�🌼」

【パターン2: ポポポ系】
挨拶: 「ポポポ、こんにちは〜！」
相槌: 「ほうほう、なるほどなのです」
語尾: 「〜なんだ、〜なのです」
```

#### 3-9. プロフィール画像管理 ⭐ NEW
- [ ] **複数パターンの丸型画像**
  - 5〜10パターン用意
  - Supabase Storageに保存
- [ ] **メッセージごとにランダム表示**
  - 同じ会話内でも画像が変わる
  - 重み付き選択可能
- [ ] **管理画面で追加・削除**
  - ドラッグ&ドロップでアップロード
  - プレビュー確認
  - 使用ON/OFF切り替え

#### 3-10. 分析ダッシュボード ⭐ NEW
- [ ] **プロフィール言及回数**
  - どの話題を何回言及したか
  - ランキング表示（グラフ）
- [ ] **訪問者の反応率**
  - 「すごい」「いいね」等のポジティブワード検出
  - 話題別のポジティブ反応率
- [ ] **話題別コンバージョン率**
  - その話題の後に問い合わせしたか
  - 効果的な話題を発見
- [ ] **時系列グラフ**
  - 最近ウケてる話題の変化
- [ ] **自動レポート**
  - 週次・月次で自動集計

#### 3-11. モニタリング
- [ ] **OpenAI API使用量**
  - リアルタイムダッシュボード
  - 日別/月別グラフ
  - コスト予測（今月末の予想）
  - アラート設定（予算超過時）
- [ ] **エラーログ**
  - API エラー
  - システムエラー
  - タイムスタンプ付き
- [ ] **パフォーマンス**
  - 応答速度
  - ページロード時間

#### 3-12. UI デザイン ⭐
- [ ] **「あっちゃんの脳内」をイメージしたデザイン**
- [ ] **ダークモード推奨**（サイバーパンク風）
- [ ] **ニューロモルフィズム** or **グラスモーフィズム**
- [ ] **特徴的なボタン**
  - 「あっちゃんの中身を覗く」ログインボタン
  - 「脳内データベース」会話履歴ボタン
  - 「創作ギャラリー」生成サイトボタン
- [ ] **アニメーション効果**（GSAP使用）
- [ ] **データビジュアライゼーション**
  - Chart.js / Recharts
  - 統計グラフ

---

## 非機能要件

### パフォーマンス
- **初回ロード**: 2秒以内
- **AI応答開始**: 1秒以内（ストリーミング）
- **サイト生成**: 5-10秒以内
- **Lighthouse スコア**: 95点以上
- **Core Web Vitals**: 全て Good

### セキュリティ
- 管理画面へのアクセス制御（Supabase Auth）
- Row Level Security（RLS）設定
- API Rate Limiting（Upstash Redis）
- XSS/CSRF対策
- 環境変数による機密情報管理
- OpenAI API キーの安全な管理
- iframe sandbox 属性（生成サイトプレビュー）

### スケーラビリティ
- 月間10,000訪問者まで対応
- 同時接続: 100ユーザー
- OpenAI APIコスト: 月3,000円以内
- Vercel無料枠/Proプランで運用可能

### 対応ブラウザ
- Chrome（最新版）
- Firefox（最新版）
- Safari（最新版）
- Edge（最新版）
- モバイルブラウザ（iOS Safari, Android Chrome）

### アクセシビリティ
- WCAG 2.1 AA準拠（可能な範囲で）
- キーボード操作対応
- スクリーンリーダー対応（チャット部分）
- 適切な色のコントラスト比

---

## ユーザーストーリー

### 一般訪問者（初回）
1. サイトにアクセスすると、**美しいパーティクルアニメーション**と共にチャット画面が表示される
2. GSAPアニメーションで「何を作りたいですか？」とあっちゃんAIが話しかけてくる
3. 「**ECサイトを作りたい**」と入力する
4. AIが詳しくヒアリングしてくれる（「どんな商品？」「デザインの好みは？」）
5. 会話の中で自然に名前を聞かれ、「**田中**」と答える
6. 要件を伝えると、AIが「**少々お待ちください、デザインしてみますね...**」
7. 10秒後、**実際に動くECサイトのプレビュー**が画面に表示される
8. 左側にHTML/CSS/JSコード、右側にリアルタイムプレビュー
9. 「すごい！本当に動いてる！」と驚く
10. 「これをベースに開発できますよ。詳しく相談してみますか？」と提案される
11. お問い合わせフォームに誘導される
12. **体験に感動し、Twitterでシェアする**

### 一般訪問者（再訪問）
1. 再びアクセスすると、「**田中さん、おかえりなさい！👋**」と迎えられる
2. 「前回、ECサイトの相談をされてましたよね」と過去の会話を覚えている
3. 続きから相談できる
4. 無料枠を使い切ると、「**メール登録で1日30回まで使えるようになります**」と提案
5. 登録してさらに詳しく相談

### 管理者（石川さん）
1. `/admin/secret-entrance` にアクセス
2. サイバーパンク風のログイン画面が表示される
3. 「**あっちゃんの中身を覗く**」ボタンでログイン
4. ダークモードのダッシュボードが表示される
5. 今日の訪問者数やチャット数をチェック
6. 「**脳内データベース**」から会話履歴を確認
7. ある訪問者の会話を見て「これは見込みあり🟢」とフラグ
8. 「**創作ギャラリー**」で生成されたサイトを閲覧
9. 面白いデザインに「いいね❤️」
10. システムプロンプトを微調整
11. OpenAI APIコストが予算内か確認
12. 「今月はあと1,200円使える」と安心

---

## 技術スタック

### フロントエンド
- **フレームワーク**: Next.js 15 (App Router)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **アニメーション**: 
  - **GSAP** (GreenSock Animation Platform) ⭐
  - Framer Motion（補助的）
- **エフェクト**:
  - tsparticles（パーティクル効果）
  - react-type-animation（タイピング効果）
- **UIライブラリ**: 
  - shadcn/ui（ベースコンポーネント）
  - Radix UI（アクセシブルなプリミティブ）
- **チャートライブラリ**: Recharts / Chart.js
- **コードエディタ**: 
  - @uiw/react-codemirror（シンタックスハイライト）
  - Prism.js / Shiki

### バックエンド
- **API**: Next.js App Router (Server Actions + Route Handlers)
- **データベース**: Supabase (PostgreSQL)
- **認証**: Supabase Auth
- **AI**: OpenAI API (GPT-4o / GPT-4o-mini)
- **AI SDK**: Vercel AI SDK
- **Rate Limiting**: Upstash Redis
- **ベクトルDB**: Supabase Vector (RAG用)

### インフラ
- **ホスティング**: Vercel
- **データベース**: Supabase
- **Rate Limiting**: Upstash Redis
- **モニタリング**: Vercel Analytics
- **エラートラッキング**: Sentry（オプション）

---

## 画面構成（超シンプル）

### 公開ページ（1画面のみ！）
1. **トップページ（チャット画面）** - `/`
   - あっちゃんAIとのチャット
   - サイト生成プレビュー（同一画面内で展開）
   - お問い合わせフォーム（モーダル）

### 管理画面
1. **ログイン** - `/admin/secret-entrance`
2. **ダッシュボード** - `/admin/dashboard`
3. **会話履歴** - `/admin/conversations`
4. **訪問者管理** - `/admin/visitors`
5. **サイト生成ログ** - `/admin/generated-sites`
6. **AI設定** - `/admin/ai-settings`
7. **プロフィール編集** - `/admin/profile` ⭐ NEW
8. **キャラクター設定** - `/admin/characters` ⭐ NEW
9. **プロフィール画像管理** - `/admin/avatars` ⭐ NEW
10. **分析ダッシュボード** - `/admin/analytics` ⭐ NEW
11. **モニタリング** - `/admin/monitoring`

---

## 開発優先順位

### Phase 1: MVP（2-3週間）
1. ✅ 基本チャット機能
2. ✅ 訪問者識別（Cookie）
3. ✅ 使用制限（シンプル版）
4. ✅ サイト生成（HTML/CSS/JS）
5. ✅ プレビュー表示
6. ✅ 管理画面（基本）

### Phase 2: UI強化（1-2週間）
1. ✅ GSAP アニメーション実装
2. ✅ パーティクルエフェクト
3. ✅ タイピングエフェクト
4. ✅ マイクロインタラクション
5. ✅ レスポンシブ対応

### Phase 3: 高度化（1-2週間）
1. ✅ RAG実装（長期記憶）
2. ✅ Tier制の完全実装
3. ✅ 管理画面UI強化
4. ✅ データビジュアライゼーション
5. ✅ モニタリング機能

### Phase 4: 最適化（1週間）
1. ✅ パフォーマンスチューニング
2. ✅ SEO対策
3. ✅ エラーハンドリング
4. ✅ テスト
5. ✅ デプロイ

---

## 成功指標（KPI）

### ビジネス目標
- **月間問い合わせ数**: 10件以上
- **コンバージョン率**: 5%以上
- **SNSシェア数**: 月50回以上

### ユーザー体験
- **平均セッション時間**: 5分以上
- **サイト生成利用率**: 30%以上
- **再訪問率**: 20%以上

### 技術目標
- **OpenAI APIコスト**: 月3,000円以内
- **ページロード速度**: 2秒以内
- **Lighthouse スコア**: 95点以上

---

## 今後の拡張案

### Phase 5以降（将来的に）
- [ ] 音声入力対応（ボイスチャット）
- [ ] 技術ブログ統合（あっちゃんが記事を要約）
- [ ] ポートフォリオギャラリー
- [ ] 多言語対応（英語版あっちゃん）
- [ ] Slack/Discord 連携（問い合わせ通知）
- [ ] 決済機能統合（有料相談プラン）
- [ ] AI学習機能（フィードバックから改善）
- [ ] コミュニティ機能

---

**次のステップ**: 技術仕様書とUI設計書を作成！
